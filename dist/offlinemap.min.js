!function t(e,n,r){function o(a,s){if(!n[a]){if(!e[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);throw new Error("Cannot find module '"+a+"'")}var c=n[a]={exports:{}};e[a][0].call(c.exports,function(t){var n=e[a][1][t];return o(n?n:t)},c,c.exports,t,e,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(t,e){(function(t){!function(){function n(t){var e=!1;return function(){if(e)throw new Error("Callback was already called.");e=!0,t.apply(r,arguments)}}var r,o,i={};r=this,null!=r&&(o=r.async),i.noConflict=function(){return r.async=o,i};var a=Object.prototype.toString,s=Array.isArray||function(t){return"[object Array]"===a.call(t)},u=function(t,e){for(var n=0;n<t.length;n+=1)e(t[n],n,t)},c=function(t,e){if(t.map)return t.map(e);var n=[];return u(t,function(t,r,o){n.push(e(t,r,o))}),n},l=function(t,e,n){return t.reduce?t.reduce(e,n):(u(t,function(t,r,o){n=e(n,t,r,o)}),n)},f=function(t){if(Object.keys)return Object.keys(t);var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e};"undefined"!=typeof t&&t.nextTick?(i.nextTick=t.nextTick,i.setImmediate="undefined"!=typeof setImmediate?function(t){setImmediate(t)}:i.nextTick):"function"==typeof setImmediate?(i.nextTick=function(t){setImmediate(t)},i.setImmediate=i.nextTick):(i.nextTick=function(t){setTimeout(t,0)},i.setImmediate=i.nextTick),i.each=function(t,e,r){function o(e){e?(r(e),r=function(){}):(i+=1,i>=t.length&&r())}if(r=r||function(){},!t.length)return r();var i=0;u(t,function(t){e(t,n(o))})},i.forEach=i.each,i.eachSeries=function(t,e,n){if(n=n||function(){},!t.length)return n();var r=0,o=function(){e(t[r],function(e){e?(n(e),n=function(){}):(r+=1,r>=t.length?n():o())})};o()},i.forEachSeries=i.eachSeries,i.eachLimit=function(t,e,n,r){var o=h(e);o.apply(null,[t,n,r])},i.forEachLimit=i.eachLimit;var h=function(t){return function(e,n,r){if(r=r||function(){},!e.length||0>=t)return r();var o=0,i=0,a=0;!function s(){if(o>=e.length)return r();for(;t>a&&i<e.length;)i+=1,a+=1,n(e[i-1],function(t){t?(r(t),r=function(){}):(o+=1,a-=1,o>=e.length?r():s())})}()}},p=function(t){return function(){var e=Array.prototype.slice.call(arguments);return t.apply(null,[i.each].concat(e))}},d=function(t,e){return function(){var n=Array.prototype.slice.call(arguments);return e.apply(null,[h(t)].concat(n))}},m=function(t){return function(){var e=Array.prototype.slice.call(arguments);return t.apply(null,[i.eachSeries].concat(e))}},y=function(t,e,n,r){if(e=c(e,function(t,e){return{index:e,value:t}}),r){var o=[];t(e,function(t,e){n(t.value,function(n,r){o[t.index]=r,e(n)})},function(t){r(t,o)})}else t(e,function(t,e){n(t.value,function(t){e(t)})})};i.map=p(y),i.mapSeries=m(y),i.mapLimit=function(t,e,n,r){return v(e)(t,n,r)};var v=function(t){return d(t,y)};i.reduce=function(t,e,n,r){i.eachSeries(t,function(t,r){n(e,t,function(t,n){e=n,r(t)})},function(t){r(t,e)})},i.inject=i.reduce,i.foldl=i.reduce,i.reduceRight=function(t,e,n,r){var o=c(t,function(t){return t}).reverse();i.reduce(o,e,n,r)},i.foldr=i.reduceRight;var g=function(t,e,n,r){var o=[];e=c(e,function(t,e){return{index:e,value:t}}),t(e,function(t,e){n(t.value,function(n){n&&o.push(t),e()})},function(){r(c(o.sort(function(t,e){return t.index-e.index}),function(t){return t.value}))})};i.filter=p(g),i.filterSeries=m(g),i.select=i.filter,i.selectSeries=i.filterSeries;var _=function(t,e,n,r){var o=[];e=c(e,function(t,e){return{index:e,value:t}}),t(e,function(t,e){n(t.value,function(n){n||o.push(t),e()})},function(){r(c(o.sort(function(t,e){return t.index-e.index}),function(t){return t.value}))})};i.reject=p(_),i.rejectSeries=m(_);var b=function(t,e,n,r){t(e,function(t,e){n(t,function(n){n?(r(t),r=function(){}):e()})},function(){r()})};i.detect=p(b),i.detectSeries=m(b),i.some=function(t,e,n){i.each(t,function(t,r){e(t,function(t){t&&(n(!0),n=function(){}),r()})},function(){n(!1)})},i.any=i.some,i.every=function(t,e,n){i.each(t,function(t,r){e(t,function(t){t||(n(!1),n=function(){}),r()})},function(){n(!0)})},i.all=i.every,i.sortBy=function(t,e,n){i.map(t,function(t,n){e(t,function(e,r){e?n(e):n(null,{value:t,criteria:r})})},function(t,e){if(t)return n(t);var r=function(t,e){var n=t.criteria,r=e.criteria;return r>n?-1:n>r?1:0};n(null,c(e.sort(r),function(t){return t.value}))})},i.auto=function(t,e){e=e||function(){};var n=f(t),r=n.length;if(!r)return e();var o={},a=[],c=function(t){a.unshift(t)},h=function(t){for(var e=0;e<a.length;e+=1)if(a[e]===t)return a.splice(e,1),void 0},p=function(){r--,u(a.slice(0),function(t){t()})};c(function(){if(!r){var t=e;e=function(){},t(null,o)}}),u(n,function(n){var r=s(t[n])?t[n]:[t[n]],a=function(t){var r=Array.prototype.slice.call(arguments,1);if(r.length<=1&&(r=r[0]),t){var a={};u(f(o),function(t){a[t]=o[t]}),a[n]=r,e(t,a),e=function(){}}else o[n]=r,i.setImmediate(p)},d=r.slice(0,Math.abs(r.length-1))||[],m=function(){return l(d,function(t,e){return t&&o.hasOwnProperty(e)},!0)&&!o.hasOwnProperty(n)};if(m())r[r.length-1](a,o);else{var y=function(){m()&&(h(y),r[r.length-1](a,o))};c(y)}})},i.retry=function(t,e,n){var r=5,o=[];"function"==typeof t&&(n=e,e=t,t=r),t=parseInt(t,10)||r;var a=function(r,a){for(var s=function(t,e){return function(n){t(function(t,r){n(!t||e,{err:t,result:r})},a)}};t;)o.push(s(e,!(t-=1)));i.series(o,function(t,e){e=e[e.length-1],(r||n)(e.err,e.result)})};return n?a():a},i.waterfall=function(t,e){if(e=e||function(){},!s(t)){var n=new Error("First argument to waterfall must be an array of functions");return e(n)}if(!t.length)return e();var r=function(t){return function(n){if(n)e.apply(null,arguments),e=function(){};else{var o=Array.prototype.slice.call(arguments,1),a=t.next();a?o.push(r(a)):o.push(e),i.setImmediate(function(){t.apply(null,o)})}}};r(i.iterator(t))()};var E=function(t,e,n){if(n=n||function(){},s(e))t.map(e,function(t,e){t&&t(function(t){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),e.call(null,t,n)})},n);else{var r={};t.each(f(e),function(t,n){e[t](function(e){var o=Array.prototype.slice.call(arguments,1);o.length<=1&&(o=o[0]),r[t]=o,n(e)})},function(t){n(t,r)})}};i.parallel=function(t,e){E({map:i.map,each:i.each},t,e)},i.parallelLimit=function(t,e,n){E({map:v(e),each:h(e)},t,n)},i.series=function(t,e){if(e=e||function(){},s(t))i.mapSeries(t,function(t,e){t&&t(function(t){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),e.call(null,t,n)})},e);else{var n={};i.eachSeries(f(t),function(e,r){t[e](function(t){var o=Array.prototype.slice.call(arguments,1);o.length<=1&&(o=o[0]),n[e]=o,r(t)})},function(t){e(t,n)})}},i.iterator=function(t){var e=function(n){var r=function(){return t.length&&t[n].apply(null,arguments),r.next()};return r.next=function(){return n<t.length-1?e(n+1):null},r};return e(0)},i.apply=function(t){var e=Array.prototype.slice.call(arguments,1);return function(){return t.apply(null,e.concat(Array.prototype.slice.call(arguments)))}};var T=function(t,e,n,r){var o=[];t(e,function(t,e){n(t,function(t,n){o=o.concat(n||[]),e(t)})},function(t){r(t,o)})};i.concat=p(T),i.concatSeries=m(T),i.whilst=function(t,e,n){t()?e(function(r){return r?n(r):(i.whilst(t,e,n),void 0)}):n()},i.doWhilst=function(t,e,n){t(function(r){if(r)return n(r);var o=Array.prototype.slice.call(arguments,1);e.apply(null,o)?i.doWhilst(t,e,n):n()})},i.until=function(t,e,n){t()?n():e(function(r){return r?n(r):(i.until(t,e,n),void 0)})},i.doUntil=function(t,e,n){t(function(r){if(r)return n(r);var o=Array.prototype.slice.call(arguments,1);e.apply(null,o)?n():i.doUntil(t,e,n)})},i.queue=function(t,e){function r(t,e,n,r){return t.started||(t.started=!0),s(e)||(e=[e]),0==e.length?i.setImmediate(function(){t.drain&&t.drain()}):(u(e,function(e){var o={data:e,callback:"function"==typeof r?r:null};n?t.tasks.unshift(o):t.tasks.push(o),t.saturated&&t.tasks.length===t.concurrency&&t.saturated(),i.setImmediate(t.process)}),void 0)}void 0===e&&(e=1);var o=0,a={tasks:[],concurrency:e,saturated:null,empty:null,drain:null,started:!1,paused:!1,push:function(t,e){r(a,t,!1,e)},kill:function(){a.drain=null,a.tasks=[]},unshift:function(t,e){r(a,t,!0,e)},process:function(){if(!a.paused&&o<a.concurrency&&a.tasks.length){var e=a.tasks.shift();a.empty&&0===a.tasks.length&&a.empty(),o+=1;var r=function(){o-=1,e.callback&&e.callback.apply(e,arguments),a.drain&&a.tasks.length+o===0&&a.drain(),a.process()},i=n(r);t(e.data,i)}},length:function(){return a.tasks.length},running:function(){return o},idle:function(){return a.tasks.length+o===0},pause:function(){a.paused!==!0&&(a.paused=!0)},resume:function(){if(a.paused!==!1){a.paused=!1;for(var t=1;t<=a.concurrency;t++)i.setImmediate(a.process)}}};return a},i.priorityQueue=function(t,e){function n(t,e){return t.priority-e.priority}function r(t,e,n){for(var r=-1,o=t.length-1;o>r;){var i=r+(o-r+1>>>1);n(e,t[i])>=0?r=i:o=i-1}return r}function o(t,e,o,a){return t.started||(t.started=!0),s(e)||(e=[e]),0==e.length?i.setImmediate(function(){t.drain&&t.drain()}):(u(e,function(e){var s={data:e,priority:o,callback:"function"==typeof a?a:null};t.tasks.splice(r(t.tasks,s,n)+1,0,s),t.saturated&&t.tasks.length===t.concurrency&&t.saturated(),i.setImmediate(t.process)}),void 0)}var a=i.queue(t,e);return a.push=function(t,e,n){o(a,t,e,n)},delete a.unshift,a},i.cargo=function(t,e){var n=!1,r=[],o={tasks:r,payload:e,saturated:null,empty:null,drain:null,drained:!0,push:function(t,n){s(t)||(t=[t]),u(t,function(t){r.push({data:t,callback:"function"==typeof n?n:null}),o.drained=!1,o.saturated&&r.length===e&&o.saturated()}),i.setImmediate(o.process)},process:function a(){if(!n){if(0===r.length)return o.drain&&!o.drained&&o.drain(),o.drained=!0,void 0;var i="number"==typeof e?r.splice(0,e):r.splice(0,r.length),s=c(i,function(t){return t.data});o.empty&&o.empty(),n=!0,t(s,function(){n=!1;var t=arguments;u(i,function(e){e.callback&&e.callback.apply(null,t)}),a()})}},length:function(){return r.length},running:function(){return n}};return o};var S=function(t){return function(e){var n=Array.prototype.slice.call(arguments,1);e.apply(null,n.concat([function(e){var n=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(e?console.error&&console.error(e):console[t]&&u(n,function(e){console[t](e)}))}]))}};i.log=S("log"),i.dir=S("dir"),i.memoize=function(t,e){var n={},r={};e=e||function(t){return t};var o=function(){var o=Array.prototype.slice.call(arguments),a=o.pop(),s=e.apply(null,o);s in n?i.nextTick(function(){a.apply(null,n[s])}):s in r?r[s].push(a):(r[s]=[a],t.apply(null,o.concat([function(){n[s]=arguments;var t=r[s];delete r[s];for(var e=0,o=t.length;o>e;e++)t[e].apply(null,arguments)}])))};return o.memo=n,o.unmemoized=t,o},i.unmemoize=function(t){return function(){return(t.unmemoized||t).apply(null,arguments)}},i.times=function(t,e,n){for(var r=[],o=0;t>o;o++)r.push(o);return i.map(r,e,n)},i.timesSeries=function(t,e,n){for(var r=[],o=0;t>o;o++)r.push(o);return i.mapSeries(r,e,n)},i.seq=function(){var t=arguments;return function(){var e=this,n=Array.prototype.slice.call(arguments),r=n.pop();i.reduce(t,n,function(t,n,r){n.apply(e,t.concat([function(){var t=arguments[0],e=Array.prototype.slice.call(arguments,1);r(t,e)}]))},function(t,n){r.apply(e,[t].concat(n))})}},i.compose=function(){return i.seq.apply(null,Array.prototype.reverse.call(arguments))};var I=function(t,e){var n=function(){var n=this,r=Array.prototype.slice.call(arguments),o=r.pop();return t(e,function(t,e){t.apply(n,r.concat([e]))},o)};if(arguments.length>2){var r=Array.prototype.slice.call(arguments,2);return n.apply(this,r)}return n};i.applyEach=p(I),i.applyEachSeries=m(I),i.forever=function(t,e){function n(r){if(r){if(e)return e(r);throw r}t(n)}n()},"undefined"!=typeof e&&e.exports?e.exports=i:"undefined"!=typeof define&&define.amd?define([],function(){return i}):r.async=i}()}).call(this,t("+xKvab"))},{"+xKvab":2}],2:[function(t,e){function n(){}var r=e.exports={};r.nextTick=function(){var t="undefined"!=typeof window&&window.setImmediate,e="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(t)return function(t){return window.setImmediate(t)};if(e){var n=[];return window.addEventListener("message",function(t){var e=t.source;if((e===window||null===e)&&"process-tick"===t.data&&(t.stopPropagation(),n.length>0)){var r=n.shift();r()}},!0),function(t){n.push(t),window.postMessage("process-tick","*")}}return function(t){setTimeout(t,0)}}(),r.title="browser",r.browser=!0,r.env={},r.argv=[],r.on=n,r.addListener=n,r.once=n,r.off=n,r.removeListener=n,r.removeAllListeners=n,r.emit=n,r.binding=function(){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(){throw new Error("process.chdir is not supported")}},{}],3:[function(t,e){!function(t,n,r){"function"==typeof define?define(n):"undefined"!=typeof e&&e.exports?e.exports=n():r[t]=n()}("IDBStore",function(){"use strict";var t=function(t){throw t},e=function(){},n={storeName:"Store",storePrefix:"IDBWrapper-",dbVersion:1,keyPath:"id",autoIncrement:!0,onStoreReady:function(){},onError:t,indexes:[],implementationPreference:["indexedDB","webkitIndexedDB","mozIndexedDB","shimIndexedDB"]},r=function(t,e){"undefined"==typeof e&&"function"==typeof t&&(e=t),"[object Object]"!=Object.prototype.toString.call(t)&&(t={});for(var r in n)this[r]="undefined"!=typeof t[r]?t[r]:n[r];this.dbName=this.storePrefix+this.storeName,this.dbVersion=parseInt(this.dbVersion,10)||1,e&&(this.onStoreReady=e);var o="object"==typeof window?window:self,i=this.implementationPreference.filter(function(t){return t in o});this.implementation=i[0],this.idb=o[this.implementation],this.keyRange=o.IDBKeyRange||o.webkitIDBKeyRange||o.mozIDBKeyRange,this.consts={READ_ONLY:"readonly",READ_WRITE:"readwrite",VERSION_CHANGE:"versionchange",NEXT:"next",NEXT_NO_DUPLICATE:"nextunique",PREV:"prev",PREV_NO_DUPLICATE:"prevunique"},this.openDB()};r.prototype={constructor:r,version:"1.6.1",db:null,dbName:null,dbVersion:null,store:null,storeName:null,storePrefix:null,keyPath:null,autoIncrement:null,indexes:null,implementationPreference:null,implementation:"",onStoreReady:null,onError:null,_insertIdCount:0,openDB:function(){var t=this.idb.open(this.dbName,this.dbVersion),e=!1;t.onerror=function(t){var e=!1;"error"in t.target?e="VersionError"==t.target.error.name:"errorCode"in t.target&&(e=12==t.target.errorCode),e?this.onError(new Error("The version number provided is lower than the existing one.")):this.onError(t)}.bind(this),t.onsuccess=function(t){if(!e){if(this.db)return this.onStoreReady(),void 0;if(this.db=t.target.result,"string"==typeof this.db.version)return this.onError(new Error("The IndexedDB implementation in this browser is outdated. Please upgrade your browser.")),void 0;if(!this.db.objectStoreNames.contains(this.storeName))return this.onError(new Error("Object store couldn't be created.")),void 0;var n=this.db.transaction([this.storeName],this.consts.READ_ONLY);this.store=n.objectStore(this.storeName);var r=Array.prototype.slice.call(this.getIndexList());this.indexes.forEach(function(t){var n=t.name;if(!n)return e=!0,this.onError(new Error("Cannot create index: No index name given.")),void 0;if(this.normalizeIndexData(t),this.hasIndex(n)){var o=this.store.index(n),i=this.indexComplies(o,t);i||(e=!0,this.onError(new Error('Cannot modify index "'+n+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))),r.splice(r.indexOf(n),1)}else e=!0,this.onError(new Error('Cannot create new index "'+n+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))},this),r.length&&(e=!0,this.onError(new Error('Cannot delete index(es) "'+r.toString()+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))),e||this.onStoreReady()}}.bind(this),t.onupgradeneeded=function(t){if(this.db=t.target.result,this.db.objectStoreNames.contains(this.storeName))this.store=t.target.transaction.objectStore(this.storeName);else{var n={autoIncrement:this.autoIncrement};null!==this.keyPath&&(n.keyPath=this.keyPath),this.store=this.db.createObjectStore(this.storeName,n)}var r=Array.prototype.slice.call(this.getIndexList());this.indexes.forEach(function(t){var n=t.name;if(n||(e=!0,this.onError(new Error("Cannot create index: No index name given."))),this.normalizeIndexData(t),this.hasIndex(n)){var o=this.store.index(n),i=this.indexComplies(o,t);i||(this.store.deleteIndex(n),this.store.createIndex(n,t.keyPath,{unique:t.unique,multiEntry:t.multiEntry})),r.splice(r.indexOf(n),1)}else this.store.createIndex(n,t.keyPath,{unique:t.unique,multiEntry:t.multiEntry})},this),r.length&&r.forEach(function(t){this.store.deleteIndex(t)},this)}.bind(this)},deleteDatabase:function(t,e){if(this.idb.deleteDatabase){this.db.close();var n=this.idb.deleteDatabase(this.dbName);n.onsuccess=t,n.onerror=e}else e(new Error("Browser does not support IndexedDB deleteDatabase!"))},put:function(n,r,o,i){null!==this.keyPath&&(i=o,o=r,r=n),i||(i=t),o||(o=e);var a,s=!1,u=null,c=this.db.transaction([this.storeName],this.consts.READ_WRITE);return c.oncomplete=function(){var t=s?o:i;t(u)},c.onabort=i,c.onerror=i,null!==this.keyPath?(this._addIdPropertyIfNeeded(r),a=c.objectStore(this.storeName).put(r)):a=c.objectStore(this.storeName).put(r,n),a.onsuccess=function(t){s=!0,u=t.target.result},a.onerror=i,c},get:function(n,r,o){o||(o=t),r||(r=e);var i=!1,a=null,s=this.db.transaction([this.storeName],this.consts.READ_ONLY);s.oncomplete=function(){var t=i?r:o;t(a)},s.onabort=o,s.onerror=o;var u=s.objectStore(this.storeName).get(n);return u.onsuccess=function(t){i=!0,a=t.target.result},u.onerror=o,s},remove:function(n,r,o){o||(o=t),r||(r=e);var i=!1,a=null,s=this.db.transaction([this.storeName],this.consts.READ_WRITE);s.oncomplete=function(){var t=i?r:o;t(a)},s.onabort=o,s.onerror=o;var u=s.objectStore(this.storeName)["delete"](n);return u.onsuccess=function(t){i=!0,a=t.target.result},u.onerror=o,s},batch:function(n,r,o){if(o||(o=t),r||(r=e),"[object Array]"!=Object.prototype.toString.call(n))o(new Error("dataArray argument must be of type Array."));else if(0===n.length)return r(!0);var i=this.db.transaction([this.storeName],this.consts.READ_WRITE);i.oncomplete=function(){var t=u?r:o;t(u)},i.onabort=o,i.onerror=o;var a=n.length,s=!1,u=!1,c=function(){a--,0!==a||s||(s=!0,u=!0)};return n.forEach(function(t){var e=t.type,n=t.key,r=t.value,a=function(t){i.abort(),s||(s=!0,o(t,e,n))};if("remove"==e){var u=i.objectStore(this.storeName)["delete"](n);u.onsuccess=c,u.onerror=a}else if("put"==e){var l;null!==this.keyPath?(this._addIdPropertyIfNeeded(r),l=i.objectStore(this.storeName).put(r)):l=i.objectStore(this.storeName).put(r,n),l.onsuccess=c,l.onerror=a}},this),i},putBatch:function(t,e,n){var r=t.map(function(t){return{type:"put",value:t}});return this.batch(r,e,n)},upsertBatch:function(n,r,o,i){"function"==typeof r&&(o=r,i=o,r={}),i||(i=t),o||(o=e),r||(r={}),"[object Array]"!=Object.prototype.toString.call(n)&&i(new Error("dataArray argument must be of type Array."));var a=this.db.transaction([this.storeName],this.consts.READ_WRITE);a.oncomplete=function(){l?o(n):i(!1)},a.onabort=i,a.onerror=i;var s=r.keyField||this.keyPath,u=n.length,c=!1,l=!1,f=0,h=function(t){var e=n[f++];e[s]=t.target.result,u--,0!==u||c||(c=!0,l=!0)};return n.forEach(function(t){var e,n=t.key,r=function(t){a.abort(),c||(c=!0,i(t))};null!==this.keyPath?(this._addIdPropertyIfNeeded(t),e=a.objectStore(this.storeName).put(t)):e=a.objectStore(this.storeName).put(t,n),e.onsuccess=h,e.onerror=r},this),a},removeBatch:function(t,e,n){var r=t.map(function(t){return{type:"remove",key:t}});return this.batch(r,e,n)},getBatch:function(n,r,o,i){if(o||(o=t),r||(r=e),i||(i="sparse"),"[object Array]"!=Object.prototype.toString.call(n))o(new Error("keyArray argument must be of type Array."));else if(0===n.length)return r([]);var a=this.db.transaction([this.storeName],this.consts.READ_ONLY);a.oncomplete=function(){var t=l?r:o;t(f)},a.onabort=o,a.onerror=o;var s=[],u=n.length,c=!1,l=!1,f=null,h=function(t){t.target.result||"dense"==i?s.push(t.target.result):"sparse"==i&&s.length++,u--,0===u&&(c=!0,l=!0,f=s)};return n.forEach(function(t){var e=function(t){c=!0,f=t,o(t),a.abort()},n=a.objectStore(this.storeName).get(t);n.onsuccess=h,n.onerror=e},this),a},getAll:function(n,r){r||(r=t),n||(n=e);var o=this.db.transaction([this.storeName],this.consts.READ_ONLY),i=o.objectStore(this.storeName);return i.getAll?this._getAllNative(o,i,n,r):this._getAllCursor(o,i,n,r),o},_getAllNative:function(t,e,n,r){var o=!1,i=null;t.oncomplete=function(){var t=o?n:r;t(i)},t.onabort=r,t.onerror=r;var a=e.getAll();a.onsuccess=function(t){o=!0,i=t.target.result},a.onerror=r},_getAllCursor:function(t,e,n,r){var o=[],i=!1,a=null;t.oncomplete=function(){var t=i?n:r;t(a)},t.onabort=r,t.onerror=r;var s=e.openCursor();s.onsuccess=function(t){var e=t.target.result;e?(o.push(e.value),e["continue"]()):(i=!0,a=o)},s.onError=r},clear:function(n,r){r||(r=t),n||(n=e);var o=!1,i=null,a=this.db.transaction([this.storeName],this.consts.READ_WRITE);a.oncomplete=function(){var t=o?n:r;t(i)},a.onabort=r,a.onerror=r;var s=a.objectStore(this.storeName).clear();return s.onsuccess=function(t){o=!0,i=t.target.result},s.onerror=r,a},_addIdPropertyIfNeeded:function(t){"undefined"==typeof t[this.keyPath]&&(t[this.keyPath]=this._insertIdCount++ +Date.now())},getIndexList:function(){return this.store.indexNames},hasIndex:function(t){return this.store.indexNames.contains(t)},normalizeIndexData:function(t){t.keyPath=t.keyPath||t.name,t.unique=!!t.unique,t.multiEntry=!!t.multiEntry},indexComplies:function(t,e){var n=["keyPath","unique","multiEntry"].every(function(n){if("multiEntry"==n&&void 0===t[n]&&e[n]===!1)return!0;if("keyPath"==n&&"[object Array]"==Object.prototype.toString.call(e[n])){var r=e.keyPath,o=t.keyPath;if("string"==typeof o)return r.toString()==o;if("function"!=typeof o.contains&&"function"!=typeof o.indexOf)return!1;if(o.length!==r.length)return!1;for(var i=0,a=r.length;a>i;i++)if(!(o.contains&&o.contains(r[i])||o.indexOf(-1!==r[i])))return!1;return!0}return e[n]==t[n]});return n},iterate:function(e,n){n=i({index:null,order:"ASC",autoContinue:!0,filterDuplicates:!1,keyRange:null,writeAccess:!1,onEnd:null,onError:t,limit:1/0,offset:0},n||{});var r="desc"==n.order.toLowerCase()?"PREV":"NEXT";n.filterDuplicates&&(r+="_NO_DUPLICATE");var o=!1,a=this.db.transaction([this.storeName],this.consts[n.writeAccess?"READ_WRITE":"READ_ONLY"]),s=a.objectStore(this.storeName);n.index&&(s=s.index(n.index));var u=0;a.oncomplete=function(){return o?(n.onEnd?n.onEnd():e(null),void 0):(n.onError(null),void 0)},a.onabort=n.onError,a.onerror=n.onError;var c=s.openCursor(n.keyRange,this.consts[r]);return c.onerror=n.onError,c.onsuccess=function(t){var r=t.target.result;r?n.offset?(r.advance(n.offset),n.offset=0):(e(r.value,r,a),u++,n.autoContinue&&(u+n.offset<n.limit?r["continue"]():o=!0)):o=!0},a},query:function(t,e){var n=[];return e=e||{},e.autoContinue=!0,e.writeAccess=!1,e.onEnd=function(){t(n)},this.iterate(function(t){n.push(t)},e)},count:function(e,n){n=i({index:null,keyRange:null},n||{});var r=n.onError||t,o=!1,a=null,s=this.db.transaction([this.storeName],this.consts.READ_ONLY);s.oncomplete=function(){var t=o?e:r;t(a)},s.onabort=r,s.onerror=r;var u=s.objectStore(this.storeName);n.index&&(u=u.index(n.index));var c=u.count(n.keyRange);return c.onsuccess=function(t){o=!0,a=t.target.result},c.onError=r,s},makeKeyRange:function(t){var e,n="undefined"!=typeof t.lower,r="undefined"!=typeof t.upper,o="undefined"!=typeof t.only;switch(!0){case o:e=this.keyRange.only(t.only);break;case n&&r:e=this.keyRange.bound(t.lower,t.upper,t.excludeLower,t.excludeUpper);break;case n:e=this.keyRange.lowerBound(t.lower,t.excludeLower);break;case r:e=this.keyRange.upperBound(t.upper,t.excludeUpper);break;default:throw new Error('Cannot create KeyRange. Provide one or both of "lower" or "upper" value, or an "only" value.')}return e}};var o={},i=function(t,e){var n,r;for(n in e)r=e[n],r!==o[n]&&r!==t[n]&&(t[n]=r);return t};return r.version=r.prototype.version,r},this)},{}],4:[function(t,e){var n,r,o;e.exports=n=function(){function t(t){this.offlineLayer=t}return t.prototype.retrieveImage=function(t,e,n){var i;return i=this.offlineLayer._createURL(t.x,t.y,t.z),r(i,function(t){return e(o(t))},n)},t}(),r=function(t,e,n){var r;return r=new XMLHttpRequest,r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(t){return 200===this.status?e(this.response):n("GET_STATUS_ERROR",t)},r.onerror=function(t){return n("NETWORK_ERROR",t)},r.send()},o=function(t){var e,n,r,o,i;for(e="",n=new Uint8Array(t),r=o=0,i=n.byteLength;i>=0?i>o:o>i;r=i>=0?++o:--o)e+=String.fromCharCode(n[r]);return"data:image/png;base64,"+btoa(e)}},{}],5:[function(t,e){var n,r,o,i;i=t("async"),r=t("./IndexedDBDataStorage"),o=t("./WebSQLDataStorage"),e.exports=n=function(){function t(t,e){if(null==e)throw new Error("the image store needs an imageRetriever");if(null==t)throw new Error("the image store needs an eventEmitter");this._eventEmitter=t,this._nbTilesLeftToSave=0,this._nbImagesCurrentlyBeingRetrieved=0,this._imageRetriever=e,this._myQueue=null,this._beingCanceled=!1,this._running=!1}return t.prototype.createDB=function(t,e,n,i){var a;if(a=i,null==e)throw new Error("This async function needs a callback");return this.storage=a?new o(t,e,n):new r(t,e,n)},t.prototype.cancel=function(){return this._running?this._beingCanceled?!0:(this._beingCanceled=!0,null!=this._myQueue?(this._myQueue.kill(),0===this._nbImagesCurrentlyBeingRetrieved&&this._finish(),!0):!1):!1},t.prototype.isBusy=function(){return this._running},t.prototype.get=function(t,e,n){if(null==e||null==n)throw new Error("This async function needs callbacks");return this.storage.get(t,e,n)},t.prototype.clear=function(t,e){if(null==t||null==e)throw new Error("This async function needs callbacks");return this.storage.clear(t,e)},t.prototype._finish=function(t,e){return this._running=!1,this._beingCanceled=!1,this._eventEmitter.fire("tilecachingprogressdone",null),this._myQueue=null,this._nbImagesCurrentlyBeingRetrieved=0,null!=t?e(t):this._onSaveImagesSuccess()},t.prototype.saveImages=function(t,e,n,r){if(this._running=!0,null!=this._myQueue)throw new Error("Not allowed to save images while saving is already in progress");if(null==e||null==n||null==r)throw new Error("This async function needs callbacks");return this._onSaveImagesSuccess=n,this._getImagesNotInDB(t,function(t){return function(n){var o,a,s,u;if(!t._beingCanceled&&null!=n&&n.length>0){for(o=8,t._myQueue=i.queue(function(e,n){return t._saveTile(e,n)},o),t._myQueue.drain=function(e){return t._finish(e,r)},s=0,u=n.length;u>s;s++)a=n[s],t._myQueue.push(a);return e()}return e(),t._finish()}}(this),function(t){return r(t)})},t.prototype._getImagesNotInDB=function(t,e,n){var r,o;o=[];for(r in t)o.push(r);return this.storage.getDenseBatch(o,function(n){return function(r){var i,a,s,u,c,l;for(i=0,u=[],n._eventEmitter.fire("tilecachingstart",null),n._nbTilesLeftToSave=0,a=function(e){var r,a;return e||(r=o[i],a=t[r],n._nbTilesLeftToSave++,u.push({key:r,tileInfo:a})),i++},c=0,l=r.length;l>c;c++)s=r[c],a(s);return n._updateTotalNbImagesLeftToSave(n._nbTilesLeftToSave),e(u)}}(this),function(t){return n(t)})},t.prototype._saveTile=function(t,e){var n,r;return r=function(n){return function(r){return n.storage.put(t.key,{image:r},function(){return n._decrementNbTilesLeftToSave(),e()},function(t){return n._decrementNbTilesLeftToSave(),e(t)})}}(this),n=function(n){return function(r,o){return n._decrementNbTilesLeftToSave(),n._eventEmitter._reportError(r,{data:o,tileInfo:t.tileInfo}),e(r)}}(this),this._nbImagesCurrentlyBeingRetrieved++,this._imageRetriever.retrieveImage(t.tileInfo,r,n)},t.prototype._updateTotalNbImagesLeftToSave=function(t){return this._nbTilesLeftToSave=t,this._eventEmitter.fire("tilecachingprogressstart",{nbTiles:this._nbTilesLeftToSave})},t.prototype._decrementNbTilesLeftToSave=function(){return this._nbTilesLeftToSave--,this._beingCanceled||this._eventEmitter.fire("tilecachingprogress",{nbTiles:this._nbTilesLeftToSave}),this._nbImagesCurrentlyBeingRetrieved--,this._beingCanceled&&0===this._nbImagesCurrentlyBeingRetrieved?this._finish():void 0},t}()},{"./IndexedDBDataStorage":6,"./WebSQLDataStorage":9,async:1}],6:[function(t,e){var n,r;n=t("idb-wrapper"),e.exports=r=function(){function t(t,e,r){this._idbStore=new n({dbVersion:1,storeName:t,keyPath:null,autoIncrement:!1},e,r)}return t.prototype.get=function(t,e,n){return this._idbStore.get(t,e,n)},t.prototype.clear=function(t,e){return this._idbStore.clear(t,e)},t.prototype.put=function(t,e,n,r){return this._idbStore.put(t,e,n,r)},t.prototype.getDenseBatch=function(t,e,n){return this._idbStore.getBatch(t,e,n,"dense")},t}()},{"idb-wrapper":3}],7:[function(t,e){var n,r,o,i={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};r=t("./ImageStore"),n=t("./ImageRetriever"),e.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.initialize=function(t,e){var o,i,a,s,u;if(L.TileLayer.prototype.initialize.call(this,t,e),this._alreadyReportedErrorForThisActions=!1,this._onReady=e.onReady,this._onError=e.onError,o=e.dbOption,s=e.storeName||"OfflineLeafletTileImages",this._tileImagesStore=null,this._minZoomLevel=12,null!=e.minZoomLevel&&(this._minZoomLevel=parseInt(e.minZoomLevel)),null==o||"None"===o)return setTimeout(function(t){return function(){return t._onReady()}}(this),0);try{return"WebSQL"===o?u=!0:"IndexedDB"===o?u=!1:this._onError("COULD_NOT_CREATE_DB","Invalid dbOption parameter: "+o),a=new n(this),this._tileImagesStore=new r(this,a),this._tileImagesStore.createDB(s,function(t){return function(){return t._onReady()}}(this),function(t){return function(e){return t._tileImagesStore=null,t._reportError("COULD_NOT_CREATE_DB",e),setTimeout(function(){return t._onReady()},0)}}(this),u)}catch(c){return i=c,this._tileImagesStore=null,this._reportError("COULD_NOT_CREATE_DB",i),setTimeout(function(t){return function(){return t._onReady()}}(this),0)}},e.prototype._setUpTile=function(t,e,n){return t.src=n,this.fire("tileloadstart",{tile:t,url:t.src})},e.prototype._reportError=function(t,e){return this._onError&&!this._alreadyReportedErrorForThisActions?(this._alreadyReportedErrorForThisActions=!0,this._onError(t,e)):void 0},e.prototype._loadTile=function(t,e){var n,r,o;return this._tileImagesStore?(t._layer=this,t.onerror=this._tileOnError,this._adjustTilePoint(e),t.onload=this._tileOnLoad,o=function(r){return function(o){return o?r._setUpTile(t,n,o.image):r._setUpTile(t,n,r.getTileUrl(e))}}(this),r=function(r){return function(){return r._setUpTile(t,n,r.getTileUrl(e)),r._reportError("DB_GET",n)}}(this),n=this._createTileKey(e.x,e.y,e.z),this._tileImagesStore.get(n,o,r)):L.TileLayer.prototype._loadTile.call(this,t,e)},e.prototype.useDB=function(){return null!==this._tileImagesStore},e.prototype.cancel=function(){return null!=this._tileImagesStore?this._tileImagesStore.cancel():!1},e.prototype.clearTiles=function(t,e){return this.useDB()?this.isBusy()?(this._reportError("SYSTEM_BUSY","System is busy."),e("System is busy."),void 0):this._tileImagesStore.clear(t,function(t){return function(n){return t._reportError("COULD_NOT_CLEAR_DB",n),e(n)}}(this)):(this._reportError("NO_DB","No DB available"),e("No DB available"),void 0)},e.prototype.calculateNbTiles=function(t,e){var n,r,o;if(this._map.getZoom()<this._minZoomLevel)return this._reportError("ZOOM_LEVEL_TOO_LOW"),-1;n=0,o=this._getTileImages(t,e?{remaining:e}:void 0);for(r in o)n++;return n},e.prototype.isBusy=function(){return null!=this._tileImagesStore?this._tileImagesStore.isBusy():!1},e.prototype._getTileImages=function(t,e){var n,r,o,i,a,s,u,c,l,f,h,p,d,m,y,v,g,_,b,E,T,S,I,w,x;for(t=t||this._map.getMaxZoom(),m={},a=this._map,p=a.getZoom(),r=a.getPixelBounds(),y=this._getTileSize(),h=L.bounds(r.min.divideBy(y)._floor(),r.max.divideBy(y)._floor()),v=[],i=b=S=h.min.y,I=h.max.y;I>=S?I>=b:b>=I;i=I>=S?++b:--b)for(o=E=w=h.min.x,x=h.max.x;x>=w?x>=E:E>=x;o=x>=w?++E:--E)v.push(new L.Point(o,i));
for(d=L.bounds(r.min.divideBy(y),r.max.divideBy(y)),l=d.min.y,u=d.max.y,c=d.min.x,s=d.max.x,e&&(e.remaining-=v.length),n=v.length,o=T=0;n>=0?n>T:T>n;o=n>=0?++T:--T)f=v[o],g=f.x,_=f.y,this._getZoomedInTiles(g,_,p,t,m,l,u,c,s,e),this._getZoomedOutTiles(g,_,p,0,m,l,u,c,s,e);return m},e.prototype.saveTiles=function(t,e,n,r,o){var i;return this._alreadyReportedErrorForThisActions=!1,this._tileImagesStore?this.isBusy()?(this._reportError("SYSTEM_BUSY","system is busy."),o("system is busy."),void 0):this._map.getZoom()<this._minZoomLevel?(this._reportError("ZOOM_LEVEL_TOO_LOW"),o("ZOOM_LEVEL_TOO_LOW"),void 0):(i=this._getTileImages(t,e?{remaining:e}:void 0),this._tileImagesStore.saveImages(i,n,r,function(t){return function(e){return t._reportError("SAVING_TILES",e),o(e)}}(this))):(this._reportError("NO_DB","No DB available"),o("No DB available"),void 0)},e.prototype._getZoomedInTiles=function(t,e,n,r,o,i,a,s,u,c){return this._getTileImage(t,e,n,o,i,a,s,u,!0,c),r>n&&!(c&&c.remaining<=0)?(i*=2,a*=2,s*=2,u*=2,this._getZoomedInTiles(2*t,2*e,n+1,r,o,i,a,s,u,c),this._getZoomedInTiles(2*t+1,2*e,n+1,r,o,i,a,s,u,c),this._getZoomedInTiles(2*t,2*e+1,n+1,r,o,i,a,s,u,c),this._getZoomedInTiles(2*t+1,2*e+1,n+1,r,o,i,a,s,u,c)):void 0},e.prototype._getZoomedOutTiles=function(t,e,n,r,o,i,a,s,u,c){return this._getTileImage(t,e,n,o,i,a,s,u,!1,c),n>r&&!(c&&c.remaining<=0)?(i/=2,a/=2,s/=2,u/=2,this._getZoomedOutTiles(Math.floor(t/2),Math.floor(e/2),n-1,r,o,i,a,s,u,c)):void 0},e.prototype._getTileImage=function(t,e,n,r,o,i,a,s,u,c){var l;if(!(t<Math.floor(a)||t>Math.floor(s)||e<Math.floor(o)||e>Math.floor(i)))return l=this._createTileKey(t,e,n),!r[l]&&(r[l]={key:l,x:t,y:e,z:n},c)?c.remaining--:void 0},e.prototype._createNormalizedTilePoint=function(t,e,n){var r;for(r=Math.pow(2,n);t>r;)t-=r;for(;0>t;)t+=r;for(;e>r;)e-=r;for(;0>e;)e+=r;return{x:t,y:e,z:n}},e.prototype._createURL=function(t,e,n){var r;return r=this._createNormalizedTilePoint(t,e,n),this.getTileUrl(r)},e.prototype._createTileKey=function(t,e,n){var r;return r=this._createNormalizedTilePoint(t,e,n),r.x+", "+r.y+", "+r.z},e}(L.TileLayer)},{"./ImageRetriever":4,"./ImageStore":5}],8:[function(t,e){var n,r={}.hasOwnProperty,o=function(t,e){function n(){this.constructor=t}for(var o in e)r.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};e.exports=n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype.onAdd=function(){var t;return t=L.DomUtil.create("div","offlinemap-controls",this._container),t.setAttribute("id","offlinemap-controls"),this._counter=L.DomUtil.create("div","offlinemap-controls-counter",t),this._counter.setAttribute("id","offlinemap-controls-counter"),this._counter.innerHTML="Ready",this._cancelButton=L.DomUtil.create("input","offlinemap-controls-cancel-button",t),this._cancelButton.setAttribute("type","button"),this._cancelButton.setAttribute("id","cancelBtn"),this._cancelButton.setAttribute("value","Cancel"),this._cancelButton.setAttribute("disabled",!0),L.DomEvent.addListener(this._cancelButton,"click",this.onCancelClick,this),L.DomEvent.disableClickPropagation(this._cancelButton),t},e.prototype.onProgressStart=function(){return this._evaluating=!0,this._counter.innerHTML="...",this._cancelButton.removeAttribute("disabled")},e.prototype.onProgressDone=function(){return this._counter.innerHTML="Ready",this._cancelButton.removeAttribute("disabled")},e.prototype.updateTotalNbTilesLeftToSave=function(t){return this._evaluating=!1,this._nbTilesToSave=t.nbTiles,this.updateNbTilesLeftToSave(t)},e.prototype.updateNbTilesLeftToSave=function(t){return this._evaluating?void 0:this._counter.innerHTML=0===this._nbTilesToSave?"100%":Math.floor((this._nbTilesToSave-t.nbTiles)/this._nbTilesToSave*100)+"%"},e.prototype.onCancelClick=function(){return this._offlineLayer.cancel()?(this._counter.innerHTML="Canceling...",this._cancelButton.setAttribute("disabled",!0)):void 0},e.prototype.setOfflineLayer=function(t){return this._offlineLayer=t,this._offlineLayer.on("tilecachingstart",this.onProgressStart,this),this._offlineLayer.on("tilecachingprogressstart",this.updateTotalNbTilesLeftToSave,this),this._offlineLayer.on("tilecachingprogress",this.updateNbTilesLeftToSave,this),this._offlineLayer.on("tilecachingprogressdone",this.onProgressDone,this)},e}(L.Control)},{}],9:[function(t,e){var n;e.exports=n=function(){function t(t,e,n){this._storeName=t,this._webSQLDB=openDatabase("OfflineTileImages","1.0","Store tile images for OfflineLeaftMap",52428800),this._webSQLDB.transaction(function(t){return function(e){return e.executeSql("CREATE TABLE IF NOT EXISTS "+t._storeName+" (key unique, image)")}}(this),n,e)}return t.prototype.get=function(t,e,n){return this._webSQLDB.transaction(function(r){return function(o){var i;return i=function(t,r){var o;return o=r.rows.length,0===o?e(void 0):1===o?e(r.rows.item(0)):n("There should be no more than one entry")},o.executeSql("SELECT * FROM "+r._storeName+" WHERE key='"+t+"'",[],i,n)}}(this))},t.prototype.clear=function(t,e){return this._webSQLDB.transaction(function(n){return function(r){return r.executeSql("DELETE FROM "+n._storeName,[],t,e)}}(this))},t.prototype.put=function(t,e,n,r){return this._webSQLDB.transaction(function(o){return function(i){return i.executeSql("INSERT OR REPLACE INTO "+o._storeName+" VALUES (?, ?)",[t,e.image],n,r)}}(this))},t.prototype.getDenseBatch=function(t,e,n){return 0===t.length&&e([]),this._webSQLDB.transaction(function(r){return function(o){var i,a,s,u,c,l,f;for(u=[],c=[],i=l=0,f=t.length;f>=0?f>l:l>f;i=f>=0?++l:--l)c.push("'"+t[i]+"'"),u.push(void 0);return a=c.join(","),s=function(n,r){var o,a,s,c;for(i=s=0,c=r.rows.length;c>=0?c>s:s>c;i=c>=0?++s:--s)a=r.rows.item(i),o=t.indexOf(a.key),o>=0&&(u[o]=a);return e(u)},o.executeSql("SELECT * FROM "+r._storeName+" WHERE key IN ("+a+")",[],s,n)}}(this))},t}()},{}],10:[function(t){window.OfflineLayer=t("./OfflineLayer"),window.OfflineProgressControl=t("./OfflineProgressControl")},{"./OfflineLayer":7,"./OfflineProgressControl":8}]},{},[10]);